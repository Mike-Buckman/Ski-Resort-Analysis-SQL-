--STATEMENT TO BRING TOGETHER DATA AND PROVIDE CATEGORIZATIONS FOR TABLEAU ANALYSIS
WITH SNOW_RANK AS
(SELECT 
R1.RESORT
,R1.COUNTRY
--RANK FOR TOP N OF SNOWFALL BY RESORT
,ROW_NUMBER() OVER (PARTITION BY  R1.Resort ORDER BY S1.snow DESC) AS SNOW_RANK_RESORT
--RANK FOR TOP N OF SNOWFAL BY COUNTRY
,ROW_NUMBER() OVER (PARTITION BY   R1.Country ORDER BY S1.snow DESC) AS SNOW_RANK_COUNTRY
--CATEGORIZATION OF BEGINNER FRIENDLY
FROM resorts R1 JOIN snow S1 
--JOIN ON ROUNDED LOCATION FOR SNOWFALL
ON ROUND(R1.Latitude) = ROUND(S1.Latitude) 
AND ROUND(R1.Longitude) = ROUND(S1.Longitude) )
SELECT 
R.Resort
,R.Latitude AS RESORT_LATITUDE
,R.Longitude AS RESORT_LONGITUDE
,R.Country	
,R.Continent
,R.Price	
,R.Season	
,R."Highest point"	
,R."Lowest point"	
,R."Beginner slopes"	
,R."Intermediate slopes"	
,R."Difficult slopes"	
,R."Total slopes"	
,R."Longest run"	
,R."Snow cannons"	
,R."Surface lifts"	
,R."Chair lifts"	
,R."Gondola lifts"	
,R."Total lifts"	
,R."Lift capacity"	
,R."Child friendly"	
,R.Snowparks	
,R.Nightskiing	
,R."Summer skiing"
,S."Month" AS SNOW_MONTH	
,S.Latitude	AS SNOW_LATITUDE
,S.Longitude AS SNOW_LONGITIUDE	
,S.Snow 
--SNOW RANKING
,SR.SNOW_RANK_COUNTRY
,SR.SNOW_RANK_RESORT
,CASE 
	WHEN R."Beginner slopes" >=25 AND R."Beginner slopes" <=35 THEN 'AVERAGE'
	WHEN R."Beginner slopes" <=25 THEN 'NOT BEGINNER'
	WHEN R."Beginner slopes"  >35 THEN 'GREAT FOR BEGINNER'
END BEGINNER_RATING
--CATEGORIZATION OF INTERMEDIATE FRIENDLY
,CASE 
	WHEN R."Intermediate slopes"  >=30 AND R."Intermediate slopes"  <=40 THEN 'AVERAGE'
	WHEN R."Intermediate slopes"  <=29 THEN 'NOT INTERMEDIATE'
	WHEN R."Intermediate slopes"   >40 THEN 'GREAT FOR INTERMEDIATE'
END INTERMEDIATE_RATING
--CATEGORIZATION OF ADVANCED FRIENDLY
,CASE 
	WHEN R."Difficult slopes"  >=15 AND R."Difficult slopes"  <=20 THEN 'AVERAGE'
	WHEN R."Difficult slopes"  <=14 THEN 'NOT DIFFICULT'
	WHEN R."Difficult slopes"  >20 THEN 'GREAT FOR ADVANCED'
END DIFFICULT_RATING
FROM resorts R JOIN snow S 
--JOIN ON ROUNDED LOCATION FOR SNOWFALL
ON ROUND(R.Latitude) = ROUND(S.Latitude) 
AND ROUND(R.Longitude) = ROUND(S.Longitude) 
--JOIN TEMP TABLE FOR RANK
JOIN SNOW_RANK SR
ON SR.RESORT = R.Resort AND SR.Country = R.Country 
